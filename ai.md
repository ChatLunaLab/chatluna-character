## ChatLuna 伪装

### 事件系统

* 启动时立刻运行，如果是新的一天就生成新的计划，否则使用原有计划
* 一个计划里面有多个不同时间的事件，对应到现实时间里。一个事件里会有很多 log，模拟人类在做事的轨迹。
* 生成计划使用 EventLoopAgent
* 定时更新计划，更新计划使用 EventLoopUpdateAgent
* 每天生成新的计划后，调用 EventLoopStatusUpdateAgent 每隔一段时间基于旧的相关状态重置新的状态。
* 事件系统可以关闭，不影响使用。事件系统只会给接下来的聊天系统增加变量而已。

### 思考系统

* 思考系统也可以进行关闭，不影响使用。
* 思考系统分为几种:
    - 1.全局思考：基于事件系统的结果和相关的话题，生成思考
    - 2.局部思考：根据每个群和用户的上下文，以及相关的话题，生成思考
* 局部思考可以设置定期执行，能实现水话题这些功能。

### 消息系统

* 支持基于关键词响应，活跃度+轮次的响应
* 支持群聊私聊，私聊总是响应，但是可以启用额外的私聊判断 Agent，判断需要回复时才触发回复，等待用户输入完成多条消息后响应
* 可以设置最大存储的上下文轮次

### 记忆系统

* 基于个人生成长期记忆，印象，状态系统
* 伪装对每个人都有不同的长期记忆，以及对它的状态（包含印象）
* 独立于聊天系统，这是不同步的。
* 生成长期记忆使用 LongTermAgent，生成对人物的状态和印象使用 UserStatusAgent

### 聊天系统

* 当消息系统触发，需要聊天，会将相关变量（状态，计划，聊天记录）打包传递给聊天系统
* 如果是群聊，需要先行使用 TopicAgent，分析聊天的多个话题，让 Agent 找出他感兴趣的话题和需要回复的消息。私聊不需要 TopicAgent。
* 之后带着感兴趣的话题和需要回复的消息，进入 SearchAgent，SearchAgent 会有计划的多步调用搜索，获取相关信息。可以设置这块的 Prompt，在不需要搜索但是需要展开话题时也可以让他搜索一些其他信息。SearchAgent 需要搜索服务，也可以关闭。
* 带着前面 TopicAgent 和 SearchAgent 的返回结果，就可以进入 ChatAgent，最终生成模拟聊天的回复。
* 回复生成后，依次调用 EventLoopStatusUpdateAgent，在调用 EventLoopNeedUpdateAgent，判断是否需要根据回复内容或者用户的聊天内容临时更新或修改计划。

Agent 基本使用 Function Calling 或 ReAct，ChatAgent 不用。上面的 Agent 都可以配置不同的模型，进行协作。
